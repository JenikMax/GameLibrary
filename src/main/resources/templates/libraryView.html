<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" href="css/library.css">
    <script>
        function gotoPage(button) {
            const page = button.getAttribute('data-page');

            const form = document.getElementById('paginationForm');
            const searchText = document.getElementsByName('searchText')[0].value;
            const selectedPlatforms = Array.from(document.querySelectorAll('input[name="selectedPlatforms"]:checked')).map(input => input.value);
            const selectedGenres = Array.from(document.querySelectorAll('input[name="selectedGenres"]:checked')).map(input => input.value);
            const selectedYears = Array.from(document.querySelectorAll('input[name="selectedYears"]:checked')).map(input => input.value);

            form.action = `/filter?searchText=${searchText}&selectedPlatforms=${selectedPlatforms.join(',')}&selectedGenres=${selectedGenres.join(',')}&selectedYears=${selectedYears.join(',')}&page=${page}`;
            form.submit();
        }
    </script>

</head>
<body>
<div class="container">
    <div class="header">
        <div class="logo">
            <img src="logo.png" alt="Logo">
        </div>
        <div class="user">
            <img src="user.png" alt="User">
            <a href="profile.html">Иван Иванов</a>
            <button type="button">Выйти</button>
        </div>
    </div>

    <div class="filter">
        <form action="/filter" method="post">
            <script>
                document.getElementById("searchText").addEventListener("keyup", function(event) {
                    if (event.keyCode === 13) {
                        event.preventDefault();
                        document.getElementById("submitButton").click();
                    }
                });
            </script>
            <h3>Поиск</h3>
            <div class="search">
                <input type="text" placeholder="Введите название игры" name="searchText" id="searchText" th:value="${searchText}">
            </div>
            <h3>Платформы</h3>
            <ul th:each="platform : ${platforms}">
                <li>
                    <input class="form-check-input" type="checkbox" th:id="'platformCheckbox-' + ${platform}" name="selectedPlatforms" th:value="${platform}" th:checked="${selectedPlatforms.contains(platform)}">
                    <label class="form-check-label" th:for="'platformCheckbox-' + ${platform}" th:text="${platform}"></label>
                </li>
            </ul>
            <h3>Жанры</h3>
            <ul th:each="genre : ${genres}">
                <li>
                    <input class="form-check-input" type="checkbox" th:id="'genreCheckbox-' + ${genre}" name="selectedGenres" th:value="${genre}" th:checked="${selectedGenres.contains(genre)}">
                    <label class="form-check-label" th:for="'genreCheckbox-' + ${genre}" th:text="${genre.toLowerCase()}"></label>
                </li>
            </ul>
            <h3>Годы выпуска</h3>
            <ul th:each="year : ${years}">
                <li>
                    <input class="form-check-input" type="checkbox" th:id="'yearCheckbox-' + ${year}" name="selectedYears" th:value="${year}" th:checked="${selectedYears.contains(year)}">
                    <label class="form-check-label" th:for="'yearCheckbox-' + ${year}" th:text="${year}"></label>
                </li>
            </ul>
            <button type="submit">Найти</button>
            <button type="reset">Сбросить</button>
        </form>
        <form action="/scan" method="post">
            <button type="submit">Обновить библиотеку</button>
        </form>
    </div>
    <div class="games">
        <h3>Список игр</h3>
        <div class="pagination">
            <a th:classappend="${page == 1} ? 'disabled' : ''" th:href="'?page=1'" tabindex="-1" aria-disabled="true">««</a>
            <a th:classappend="${page == 1} ? 'disabled' : ''" th:href="'?page=' + (${page} - 1)" tabindex="-1" aria-disabled="true">«</a>
            <a class="disabled" th:if="${page > 4}">...</a>
            <a th:each="number : ${pages}" th:classappend="${number == page} ? 'active' : ''" th:href="'?page=' + ${number}" th:text="${number}"></a>
            <a class="disabled" th:if="${page < totalPages - 3}">...</a>
            <a th:classappend="${page == totalPages} ? 'disabled' : ''" th:href="'?page=' + (${page} + 1)">»</a>
            <a th:classappend="${page == totalPages} ? 'disabled' : ''" th:href="'?page=' + ${totalPages}">»»</a>
        </div>
        <ul>
        <div th:each="game : ${gameList}" class="col-md-4 mb-4">
            <li>
                <span th:text="${game.platform}"></span>
                <img th:src="${game.logo}" th:alt="${game.name}">
                <p th:text="${game.name} + ' ('+ ${game.releaseDate} + ')'"></p>
            </li>
        </div>
        </ul>
        <div class="pagination">
            <form id="paginationForm" action="/filter" method="post">
                <button type="submit" th:disabled="${page == 1}" th:attr="data-page='1'"  onclick="gotoPage(this)">««</button>
                <button type="submit" th:disabled="${page == 1}" th:attr="data-page=${page - 1}"  onclick="gotoPage(this)">«</button>
                <button th:each="number : ${pages}" type="button" th:classappend="${number == page} ? 'active' : ''" th:attr="data-page=${number}" onclick="gotoPage(this)" th:text="${number}"></button>
                <button type="submit" th:disabled="${page == totalPages}" th:attr="data-page=${page + 1}" onclick="gotoPage(this)">»</button>
                <button type="submit" th:disabled="${page == totalPages}" th:attr="data-page=${totalPages}" onclick="gotoPage(this)">»»</button>
            </form>
        </div>
    </div>
</div>
</body>
</html>